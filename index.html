<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Kanit:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Kanit', sans-serif;
        }
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        /* Style for custom menu card in Modal (retained) */
        .matcha-menu-card, .coffee-menu-card, .smoothie-menu-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .matcha-menu-card { background-color: #f0fdf4; }
        .matcha-menu-card:hover { background-color: #dcfce7; }
        .coffee-menu-card { background-color: #fcf8f3; }
        .coffee-menu-card:hover { background-color: #fbede3; }
        .smoothie-menu-card { background-color: #f0f9ff; }
        .smoothie-menu-card:hover { background-color: #e0f2fe; }
        .price-small { color: #10b981; font-weight: 500; }
        .price-large { color: #059669; font-weight: 700; }
        .price-coffee { color: #7c2d12; font-weight: 700; }
        .price-smoothie { color: #0284c7; font-weight: 700; }
        
        /* QR Image Container Style */
        .qr-image-container {
            width: 256px;
            height: 256px;
            margin: 0 auto;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 max-w-7xl">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-teal-600">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</h1>
            <p class="text-gray-500">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
        </header>

        <div id="qr-payment-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden z-50">
            <div class="bg-white rounded-lg p-8 shadow-xl text-center w-11/12 max-w-sm">
                <h3 class="text-2xl font-bold text-teal-600 mb-2">Krungthai THAI QR PAYMENT</h3>
                <p class="text-xl font-medium text-gray-800 mb-3">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: <span id="qr-total-amount" class="text-red-600 font-extrabold">‡∏ø0</span></p>
                
                <div class="flex justify-center flex-col items-center p-2 bg-white border border-gray-100 rounded-xl shadow-lg mb-4">
                    
                    <div class="qr-image-container my-4">
                        <img src="https://raw.githubusercontent.com/khamphi880-boop/Order-Menu/c9af72f12e59972d1bed7b54fc7ab6831bd56952/176464.jpg" 
                             alt="Krungthai PromptPay QR Code" 
                             class="w-full h-full object-contain mx-auto">
                    </div>
                    
                    <div class="w-full p-2 border-t pt-2">
                        <p class="text-base text-gray-700 font-semibold">
                            ‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ: <span class="font-bold text-gray-900">‡∏ô.‡∏™.‡∏ô‡∏§‡∏ï‡∏ç‡∏≤ ‡∏ô‡∏≤‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏£‡∏±‡∏Å‡∏©‡πå</span>
                        </p>
                    </div>
                </div>

                <p class="text-sm text-red-500 mt-2">
                    *‡∏¢‡∏≠‡∏î‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏±‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô)
                </p>

                <button onclick="shareOrderSummary()" class="mt-4 w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 rounded-lg flex items-center justify-center space-x-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.882 13.791 9 14.271 9 14.75c0 1.282-.622 2.45-1.608 3.018l-3.376 1.948A2.5 2.5 0 011 19.5V4.5a2.5 2.5 0 014.016-1.948l3.376 1.948A4.5 4.5 0 019 9.25c0 .479-.118.958-.316 1.407M16 12a4 4 0 100-8 4 4 0 000 8zM18 16a4 4 0 100-8 4 4 0 000 8z"></path></svg>
                    <span>‡πÅ‡∏ä‡∏£‡πå‡∏™‡∏£‡∏∏‡∏õ‡∏ö‡∏¥‡∏• (LINE, ‡∏≠‡∏∑‡πà‡∏ô‡πÜ)</span>
                </button>
                
                <button onclick="document.getElementById('qr-payment-modal').classList.add('hidden')" class="mt-3 w-full bg-teal-500 hover:bg-teal-600 text-white font-bold py-2 rounded-lg">
                    ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
                </button>
            </div>
        </div>
        </div>
    
    <script>
        // *** Menu Data (Full lists - Omitted for brevity but must be included) ***
        // ... (Include all menu data arrays here) ...
        const menuData = [ /* ... */ ];
        const matchaMenuData = [ /* ... */ ];
        const coffeeMenuData = [ /* ... */ ];
        const fruitSmoothieData = [ /* ... */ ];
        const smoothieYogurtData = [ /* ... */ ];
        const allMenuData = [/* ... */]; // Combine all menus

        const sweetnessOptions = ['100%', '75%', '50%', '25%']; 

        let currentOrder = [];
        let orderQueue = JSON.parse(localStorage.getItem('orderQueue')) || []; 
        let orderCounter = orderQueue.length > 0 ? Math.max(...orderQueue.map(o => o.id)) + 1 : 1;

        // ... (All other Element variables) ...

        // NEW: Global variable to hold the last committed order for sharing
        let lastCommittedOrder = null;

        // Helper function to find item data from all menus (Omitted for brevity)
        function getItemDataById(itemId) {
            return allMenuData.find(i => i.id === itemId);
        }

        // ... (All other helper functions: showPaymentQRModal, renderMenu, updateOrderItem, etc.) ...

        
        // ===========================================
        // NEW: Share Functionality
        // ===========================================

        function shareOrderSummary() {
            if (!lastCommittedOrder) {
                alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ä‡∏£‡πå');
                return;
            }

            const itemsText = lastCommittedOrder.items.map(item => 
                * ${item.name} (${item.size}, ‡∏´‡∏ß‡∏≤‡∏ô ${item.sweetness}) x${item.quantity} = ‡∏ø${(item.price * item.quantity).toLocaleString('th-TH')}
            ).join('\n');

            const shareText = 
                ‚úÖ *‡∏™‡∏£‡∏∏‡∏õ‡∏ö‡∏¥‡∏• #${lastCommittedOrder.id} - ${new Date().toLocaleDateString('th-TH')}*\n +
                ----------------------------------------\n +
                ${itemsText}\n +
                ----------------------------------------\n +
                üìç ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: ${lastCommittedOrder.address}\n +
                üí∞ *‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô: ‡∏ø${lastCommittedOrder.total.toLocaleString('th-TH')}*\n\n +
                üí¨ *[‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô] ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ QR Code ‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏ö‡∏°‡∏≤‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô*\n +
                `‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ: ‡∏ô.‡∏™.‡∏ô‡∏§‡∏ï‡∏ç‡∏≤ ‡∏ô‡∏≤‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏£‡∏±‡∏Å‡∏©‡πå`;

            if (navigator.share) {
                // ‡πÉ‡∏ä‡πâ Web Share API ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ (‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏ä‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö)
                navigator.share({
                    title: `‡∏ö‡∏¥‡∏•‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå #${lastCommittedOrder.id}`,
                    text: shareText
                }).catch((error) => console.log('Error sharing', error));
            } else {
                // Fallback: ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏õ‡∏ó‡∏µ‡πà Clipboard
                navigator.clipboard.writeText(shareText)
                    .then(() => alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡∏£‡∏∏‡∏õ‡∏ö‡∏¥‡∏• (‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°) ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏Ñ‡∏•‡∏¥‡∏õ‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÅ‡∏•‡πâ‡∏ß! ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ô‡∏≥‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡πÉ‡∏ô LINE ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢'))
                    .catch(err => console.error('Could not copy text: ', err));
            }
        }
        
        // ===========================================
        // UPDATED: Submit Order
        // ===========================================

        submitOrderBtn.addEventListener('click', () => {
            const orderTotal = currentOrder.reduce((sum, item) => sum + item.price * item.quantity, 0);

            if (currentOrder.length > 0) {
                const address = deliveryAddressInput.value.trim();
                const newOrder = {
                    id: orderCounter++,
                    items: [...currentOrder],
                    total: orderTotal,
                    address: address || '‡∏£‡∏±‡∏ö‡πÄ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô',
                    status: '‡∏Ñ‡∏¥‡∏ß', 
                    placedAt: Date.now(), 
                };
                if (newOrder.address === '‡∏£‡∏±‡∏ö‡πÄ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô') {
                    if (!confirm("‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà ‡∏à‡∏∞‡∏ñ‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô '‡∏£‡∏±‡∏ö‡πÄ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô' ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) { return; }
                }
                
                // Set the last committed order for sharing
                lastCommittedOrder = newOrder;

                orderQueue.push(newOrder);
                currentOrder = [];
                deliveryAddressInput.value = '';
                renderCurrentOrder();
                renderOrderQueue();
                saveOrderQueue(); 
                
                // Show QR Code Modal
                showPaymentQRModal(orderTotal);
            }
        });
        
        // ... (Rest of the JavaScript functions) ...

        // Initial setup (Omitted for brevity)
        // ...
    </script>

</body>
</html>
