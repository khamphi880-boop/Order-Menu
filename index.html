<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå (Firebase)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Kanit:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Kanit', sans-serif;
        }
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        /* Style for custom menu card in Modal (retained) */
        .matcha-menu-card, .coffee-menu-card, .smoothie-menu-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .matcha-menu-card { background-color: #f0fdf4; }
        .matcha-menu-card:hover { background-color: #dcfce7; }
        .coffee-menu-card { background-color: #fcf8f3; }
        .coffee-menu-card:hover { background-color: #fbede3; }
        .smoothie-menu-card { background-color: #f0f9ff; }
        .smoothie-menu-card:hover { background-color: #e0f2fe; }
        .price-small { color: #10b981; font-weight: 500; }
        .price-large { color: #059669; font-weight: 700; }
        .price-coffee { color: #7c2d12; font-weight: 700; }
        .price-smoothie { color: #0284c7; font-weight: 700; }
        
        /* QR Image Container Style */
        .qr-image-container {
            width: 256px;
            height: 256px;
            margin: 0 auto;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 max-w-7xl">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-teal-600">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</h1>
            <p class="text-gray-500">‡πÉ‡∏ä‡πâ Firebase Firestore ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏ß‡πÅ‡∏ö‡∏ö Realtime</p>
        </header>

        <div class="bg-white p-6 rounded-2xl shadow-lg mb-8">
            <h2 class="text-2xl font-semibold mb-4 border-b pb-2">üìä ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center mb-4">
                <div class="bg-blue-50 p-4 rounded-xl">
                    <p class="text-sm text-blue-600 font-medium">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p>
                    <p id="sales-today" class="text-3xl font-bold text-blue-800">‡∏ø0</p>
                </div>
                <div class="bg-green-50 p-4 rounded-xl">
                    <p class="text-sm text-green-600 font-medium">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ</p>
                    <p id="sales-week" class="text-3xl font-bold text-green-800">‡∏ø0</p>
                </div>
                <div class="bg-purple-50 p-4 rounded-xl">
                    <p class="text-sm text-purple-600 font-medium">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</p>
                    <p id="sales-month" class="text-3xl font-bold text-purple-800">‡∏ø0</p>
                </div>
            </div>
            
            <button onclick="showMenuReport()" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300">
                ‚≠ê ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ
            </button>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div class="bg-white p-6 rounded-2xl shadow-lg">
                <h2 class="text-2xl font-semibold mb-4 border-b pb-2">‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°</h2>
                <div id="menu-grid" class="grid grid-cols-2 md:grid-cols-3 gap-4 h-[60vh] overflow-y-auto no-scrollbar pr-2">
                    
                    <div class="p-3 bg-amber-700 hover:bg-amber-800 text-white font-bold rounded-lg text-center cursor-pointer transition duration-300 shadow-lg" onclick="showCoffeeMenuModal()">
                        <span class="font-semibold">‚òï ‡πÄ‡∏°‡∏ô‡∏π‡∏Å‡∏≤‡πÅ‡∏ü (COFFEE)</span>
                        <p class="text-xs mt-1">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</p>
                    </div>

                    <div class="p-3 bg-emerald-500 hover:bg-emerald-600 text-white font-bold rounded-lg text-center cursor-pointer transition duration-300 shadow-lg" onclick="showMatchaMenuModal()">
                        <span class="font-semibold">üçµ ‡πÄ‡∏°‡∏ô‡∏π‡∏°‡∏±‡∏ó‡∏â‡∏∞/‡∏ä‡∏≤‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß</span>
                        <p class="text-xs mt-1">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</p>
                    </div>
                    
                    <div class="p-3 bg-sky-500 hover:bg-sky-600 text-white font-bold rounded-lg text-center cursor-pointer transition duration-300 shadow-lg" onclick="showFruitSmoothieModal()">
                        <span class="font-semibold">üçì ‡πÄ‡∏°‡∏ô‡∏π‡∏™‡∏°‡∏π‡∏ó‡∏ï‡∏µ‡πâ‡∏ú‡∏•‡πÑ‡∏°‡πâ/‡πÇ‡∏¢‡πÄ‡∏Å‡∏¥‡∏£‡πå‡∏ï</span>
                        <p class="text-xs mt-1">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</p>
                    </div>

                </div>
            </div>

            <div class="flex flex-col gap-8">
                <div class="bg-white p-6 rounded-2xl shadow-lg flex-grow flex flex-col">
                    <h2 class="text-2xl font-semibold mb-4 border-b pb-2">‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</h2>
                    <div id="current-order-items" class="flex-grow space-y-2 overflow-y-auto no-scrollbar pr-2 mb-4 min-h-[150px]">
                        <p class="text-gray-400 text-center mt-4">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡∏à‡∏≤‡∏Å‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°...</p>
                    </div>
                    
                    <div class="mb-4">
                        <label for="delivery-address" class="block text-sm font-medium text-gray-700 mb-1">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á (Delivery Address)</label>
                        <textarea id="delivery-address" rows="3" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà"></textarea>
                    </div>
                    
                    <div class="border-t pt-4">
                        <div class="flex justify-between items-center text-xl font-bold mb-4">
                            <span>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</span>
                            <span id="total-price" class="text-teal-600">‡∏ø0</span>
                        </div>
                        <button id="submit-order-btn" class="w-full bg-teal-500 hover:bg-teal-600 text-white font-bold py-3 px-4 rounded-lg transition duration-300 disabled:bg-gray-300">
                            ‡∏™‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå
                        </button>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-2xl shadow-lg">
                    <h2 class="text-2xl font-semibold mb-4 border-b pb-2">‡∏Ñ‡∏¥‡∏ß‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</h2>
                    <div id="order-queue" class="space-y-4 h-[25vh] overflow-y-auto no-scrollbar pr-2">
                            <p class="text-gray-400 text-center mt-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏¥‡∏ß‡∏à‡∏≤‡∏Å Firebase...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="success-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg p-8 shadow-xl text-center">
            <svg class="w-16 h-16 text-green-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            <h3 class="text-2xl font-semibold mb-2">‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h3>
            <p class="text-gray-600" id="modal-message"></p>
        </div>
    </div>

    <div id="menu-report-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg p-6 shadow-xl w-11/12 max-w-2xl">
            <div class="flex justify-between items-center border-b pb-3 mb-4">
                <h3 class="text-2xl font-semibold text-teal-600">‚≠ê ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ</h3>
                <button onclick="document.getElementById('menu-report-modal').classList.add('hidden')" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div id="menu-report-content" class="h-96 overflow-y-auto">
                </div>
        </div>
    </div>

    <div id="matcha-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg p-6 shadow-xl w-11/12 max-w-lg">
            <div class="flex justify-between items-center border-b pb-3 mb-4">
                <h3 class="text-2xl font-bold text-emerald-600">üçµ ‡πÄ‡∏°‡∏ô‡∏π‡∏ä‡∏≤‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß/‡∏°‡∏±‡∏ó‡∏â‡∏∞ (GREEN TEA)</h3>
                <button onclick="document.getElementById('matcha-modal').classList.add('hidden')" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div class="flex justify-between text-center font-bold text-gray-600 mb-2">
                <span class="w-1/2 text-left">‡πÄ‡∏°‡∏ô‡∏π</span>
                <span class="w-1/4">16 Oz.</span>
                <span class="w-1/4">22 Oz.</span>
            </div>
            <div id="matcha-menu-list" class="space-y-2 h-96 overflow-y-auto pr-2">
                </div>
        </div>
    </div>

    <div id="coffee-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg p-6 shadow-xl w-11/12 max-w-lg">
            <div class="flex justify-between items-center border-b pb-3 mb-4">
                <h3 class="text-2xl font-bold text-amber-700">‚òï ‡πÄ‡∏°‡∏ô‡∏π‡∏Å‡∏≤‡πÅ‡∏ü (COFFEE)</h3>
                <button onclick="document.getElementById('coffee-modal').classList.add('hidden')" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div class="flex justify-between text-center font-bold text-gray-600 mb-2">
                <span class="w-2/3 text-left">‡πÄ‡∏°‡∏ô‡∏π</span>
                <span class="w-1/3 text-right">‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ø)</span>
            </div>
            <div id="coffee-menu-list" class="space-y-2 h-96 overflow-y-auto pr-2">
                </div>
        </div>
    </div>
    
    <div id="fruit-smoothie-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg p-6 shadow-xl w-11/12 max-w-lg">
            <div class="flex justify-between items-center border-b pb-3 mb-4">
                <h3 class="text-2xl font-bold text-sky-600">üçì ‡πÄ‡∏°‡∏ô‡∏π‡∏™‡∏°‡∏π‡∏ó‡∏ï‡∏µ‡πâ‡∏ú‡∏•‡πÑ‡∏°‡πâ/‡πÇ‡∏¢‡πÄ‡∏Å‡∏¥‡∏£‡πå‡∏ï</h3>
                <button onclick="document.getElementById('fruit-smoothie-modal').classList.add('hidden')" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div class="text-sm text-gray-500 mb-2">
                <p class="font-bold text-sky-700">Fruit Smoothie (‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏õ‡∏±‡πà‡∏ô)</p>
            </div>
            <div id="fruit-smoothie-list" class="space-y-2 mb-4 border-b pb-4">
                </div>

            <div class="text-sm text-gray-500 mb-2">
                <p class="font-bold text-sky-700">Smoothie Yogurt (‡∏™‡∏°‡∏π‡∏ó‡∏ï‡∏µ‡πâ‡πÇ‡∏¢‡πÄ‡∏Å‡∏¥‡∏£‡πå‡∏ï)</p>
            </div>
            <div id="smoothie-yogurt-list" class="space-y-2 h-64 overflow-y-auto pr-2">
                </div>

        </div>
    </div>
    
    <div id="qr-payment-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg p-8 shadow-xl text-center w-11/12 max-w-sm">
            <h3 class="text-2xl font-bold text-teal-600 mb-2">Krungthai THAI QR PAYMENT</h3>
            <p class="text-xl font-medium text-gray-800 mb-3">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: <span id="qr-total-amount" class="text-red-600 font-extrabold">‡∏ø0</span></p>
            
            <div class="flex justify-center flex-col items-center p-2 bg-white border border-gray-100 rounded-xl shadow-lg mb-4">
                
                <div class="qr-image-container my-4">
                    <img src="https://raw.githubusercontent.com/khamphi880-boop/Order-Menu/c9af72f12e59972d1bed7b54fc7ab6831bd56952/176464.jpg" 
                            alt="Krungthai PromptPay QR Code" 
                            class="w-full h-full object-contain mx-auto">
                </div>
                
                <div class="w-full p-2 border-t pt-2">
                    <p class="text-base text-gray-700 font-semibold">
                        ‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ: <span class="font-bold text-gray-900">‡∏ô.‡∏™.‡∏ô‡∏§‡∏ï‡∏ç‡∏≤ ‡∏ô‡∏≤‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏£‡∏±‡∏Å‡∏©‡πå</span>
                    </p>
                </div>
            </div>

            <p class="text-sm text-red-500 mt-2">
                *‡∏¢‡∏≠‡∏î‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏±‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô)
            </p>

            <button onclick="shareOrderSummary()" class="mt-4 w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 rounded-lg flex items-center justify-center space-x-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.882 13.791 9 14.271 9 14.75c0 1.282-.622 2.45-1.608 3.018l-3.376 1.948A2.5 2.5 0 011 19.5V4.5a2.5 2.5 0 014.016-1.948l3.376 1.948A4.5 4.5 0 019 9.25c0 .479-.118.958-.316 1.407M16 12a4 4 0 100-8 4 4 0 000 8zM18 16a4 4 0 100-8 4 4 0 000 8z"></path></svg>
                <span>‡πÅ‡∏ä‡∏£‡πå‡∏™‡∏£‡∏∏‡∏õ‡∏ö‡∏¥‡∏• (LINE, ‡∏≠‡∏∑‡πà‡∏ô‡πÜ)</span>
            </button>
            
            <button onclick="document.getElementById('qr-payment-modal').classList.add('hidden')" class="mt-3 w-full bg-teal-500 hover:bg-teal-600 text-white font-bold py-2 rounded-lg">
                ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
            </button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script> 

    <script>
        // 2. ‡πÇ‡∏Ñ‡πâ‡∏î Configuration ‡∏Ç‡∏≠‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏Ñ‡∏∏‡∏ì
        // !!! ATTENTION !!!: ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏Ñ‡∏∏‡∏ì
        const firebaseConfig = {
            // ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å image_9f1eec.png ‡πÅ‡∏ï‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô storageBucket ‡πÄ‡∏õ‡πá‡∏ô .appspot.com 
            apiKey: "AIzaSyDztPWzAu8Lz8olg_dhlCLBQVEyjTQqpOk", // <--- REPLACE
            authDomain: "ordermanagement-f6724.firebaseapp.com", // <--- REPLACE
            projectId: "ordermanagement-f6724", // <--- REPLACE
            storageBucket: "ordermanagement-f6724.appspot.com", // <--- REPLACE (‡πÉ‡∏ä‡πâ .appspot.com)
            messagingSenderId: "321286666597",
            appId: "1:321286666597:web:062fef7df8fc456fec098c",
        };

        // 3. Initialize App ‡πÅ‡∏•‡∏∞ Firestore
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        // ====================================================================
        // üìù START: ‡πÇ‡∏Ñ‡πâ‡∏î JavaScript ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå (‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô Firebase) üìù
        // ====================================================================

        // *** Menu Data (Full lists) - ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° ***
        const menuData = [
            { id: 1, name: '‡πÄ‡∏ú‡∏∑‡∏≠‡∏Å', prices: { '16 Oz.': 30, '22 Oz. ‡πÄ‡∏¢‡πá‡∏ô': 40, '22 Oz. ‡∏õ‡∏±‡πà‡∏ô': 45 } },
            // ... (‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏ñ‡∏π‡∏Å‡∏•‡∏∞‡πÑ‡∏ß‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö)
            { id: 29, name: '‡∏ä‡∏≤‡∏•‡∏¥‡πâ‡∏ô‡∏à‡∏µ‡πà', prices: { '16 Oz.': 35, '22 Oz. ‡πÄ‡∏¢‡πá‡∏ô': 45, '22 Oz. ‡∏õ‡∏±‡πà‡∏ô': 50 } },
        ];
        
        const matchaMenuData = [
            { id: -1, name: '‡πÄ‡∏û‡∏µ‡∏¢‡∏ß‡∏°‡∏±‡∏ó‡∏â‡∏∞', prices: { '16 Oz. ‡πÄ‡∏¢‡πá‡∏ô': 40, '22 Oz. ‡πÄ‡∏¢‡πá‡∏ô': 40 } },
            // ... (‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏ñ‡∏π‡∏Å‡∏•‡∏∞‡πÑ‡∏ß‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö)
            { id: -18, name: '‡∏°‡∏±‡∏ó‡∏â‡∏∞ ‡∏ñ‡∏±‡πà‡∏ß‡πÅ‡∏î‡∏á (‡∏õ‡∏±‡πà‡∏ô)', prices: { '22 Oz. ‡∏õ‡∏±‡πà‡∏ô': 70 } },
        ];
        
        const coffeeMenuData = [
            { id: -101, name: '‡∏≠‡πÄ‡∏°‡∏£‡∏¥‡∏Å‡∏≤‡πÇ‡∏ô‡πà', prices: { '‡πÄ‡∏¢‡πá‡∏ô': 45, '‡∏õ‡∏±‡πà‡∏ô': 55 } },
            // ... (‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏ñ‡∏π‡∏Å‡∏•‡∏∞‡πÑ‡∏ß‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö)
            { id: -115, name: '‡∏Ñ‡∏≤‡∏£‡∏≤‡πÄ‡∏°‡∏• ‡πÄ‡∏Æ‡πÄ‡∏ã‡∏•‡∏ô‡∏±‡∏ó ‡∏•‡∏≤‡πÄ‡∏ï‡πâ', prices: { '‡πÄ‡∏¢‡πá‡∏ô': 55, '‡∏õ‡∏±‡πà‡∏ô': 65 } },
        ];
        
        const fruitSmoothieData = [
            { id: -201, name: '‡∏ô‡∏°‡∏™‡∏î ‡∏Å‡∏µ‡∏ß‡∏µ‡πà', prices: { '16 Oz. ‡πÄ‡∏¢‡πá‡∏ô': 40, '16 Oz. ‡∏õ‡∏±‡πà‡∏ô': 45, '22 Oz. ‡πÄ‡∏¢‡πá‡∏ô': 50, '22 Oz. ‡∏õ‡∏±‡πà‡∏ô': 55 } },
            // ... (‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏ñ‡∏π‡∏Å‡∏•‡∏∞‡πÑ‡∏ß‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö)
            { id: -209, name: '‡∏ö‡∏•‡∏π‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ‡πà ‡∏ä‡πá‡∏≠‡∏Å', prices: { '16 Oz. ‡πÄ‡∏¢‡πá‡∏ô': 55, '16 Oz. ‡∏õ‡∏±‡πà‡∏ô': 60, '22 Oz. ‡πÄ‡∏¢‡πá‡∏ô': 65, '22 Oz. ‡∏õ‡∏±‡πà‡∏ô': 70 } },
        ];

        const smoothieYogurtData = [
            { id: -301, name: '‡∏Å‡∏µ‡∏ß‡∏µ‡πà', prices: { '16 Oz. ‡∏õ‡∏±‡πà‡∏ô': 50, '22 Oz. ‡∏õ‡∏±‡πà‡∏ô': 60 } },
            // ... (‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏ñ‡∏π‡∏Å‡∏•‡∏∞‡πÑ‡∏ß‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö)
            { id: -308, name: '‡∏™‡πâ‡∏°', prices: { '16 Oz. ‡∏õ‡∏±‡πà‡∏ô': 50, '22 Oz. ‡∏õ‡∏±‡πà‡∏ô': 60 } },
        ];

        // ‡∏£‡∏ß‡∏°‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        const allMenuData = [...menuData, ...matchaMenuData, ...coffeeMenuData, ...fruitSmoothieData, ...smoothieYogurtData];
        const sweetnessOptions = ['100%', '75%', '50%', '25%'];

        // üî• Firebase Global Variables üî•
        let currentOrder = [];
        let orderQueue = []; // ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏´‡πâ Firebase Listener ‡∏î‡∏∂‡∏á‡∏°‡∏≤
        let menuSalesLog = []; 

        const menuGrid = document.getElementById('menu-grid');
        const currentOrderItemsEl = document.getElementById('current-order-items');
        const totalPriceEl = document.getElementById('total-price');
        const submitOrderBtn = document.getElementById('submit-order-btn');
        const orderQueueEl = document.getElementById('order-queue');
        const deliveryAddressInput = document.getElementById('delivery-address');

        const salesTodayEl = document.getElementById('sales-today');
        const salesWeekEl = document.getElementById('sales-week');
        const salesMonthEl = document.getElementById('sales-month');
        const menuReportModal = document.getElementById('menu-report-modal');
        const menuReportContent = document.getElementById('menu-report-content');
        const qrPaymentModal = document.getElementById('qr-payment-modal');
        const qrTotalAmountEl = document.getElementById('qr-total-amount');

        let lastCommittedOrder = null;
        
        // ... (Helper Functions: getItemDataById, showPaymentQRModal, isToday, isThisWeek, isThisMonth) ...
        // *** ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏•‡∏∞‡πÑ‡∏ß‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö ‡πÅ‡∏ï‡πà‡∏ñ‡∏π‡∏Å‡∏£‡∏ß‡∏°‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏â‡∏ö‡∏±‡∏ö‡πÄ‡∏ï‡πá‡∏° ***
        
        function getItemDataById(itemId) {
            return allMenuData.find(i => i.id === itemId);
        }
        
        function showPaymentQRModal(orderTotal) {
            qrTotalAmountEl.textContent = `‡∏ø${orderTotal.toLocaleString('th-TH')}`;
            qrPaymentModal.classList.remove('hidden');
        }

        function isToday(date) {
            const today = new Date();
            return date.getDate() === today.getDate() && date.getMonth() === today.getMonth() && date.getFullYear() === today.getFullYear();
        }

        function isThisWeek(date) {
            const now = new Date();
            const startOfWeek = new Date(now.setDate(now.getDate() - now.getDay()));
            const endOfWeek = new Date(now.setDate(now.getDate() - now.getDay() + 6));
            return date >= startOfWeek && date <= endOfWeek;
        }

        function isThisMonth(date) {
            const now = new Date();
            return date.getMonth() === now.getMonth() && date.getFullYear() === now.getFullYear();
        }


        // üî• Firebase Realtime Listeners (‡∏ä‡∏∏‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î) üî•
        function initFirebaseListeners() {
            // 1. Realtime Listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏¥‡∏ß‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå (orders Collection)
            db.collection("orders").onSnapshot(snapshot => { 
                orderQueue = snapshot.docs.map(doc => ({ 
                    id: doc.id, 
                    ...doc.data() 
                }));
                
                // ‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏ß‡∏¢ JavaScript 
                orderQueue.sort((a, b) => {
                    const statusOrder = { '‡∏Ñ‡∏¥‡∏ß': 1, '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥': 2, '‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß': 3, '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å': 4 };
                    const statusA = statusOrder[a.status];
                    const statusB = statusOrder[b.status];

                    // 1. ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (‡∏Ñ‡∏¥‡∏ß > ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥ > ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß)
                    if (statusA !== statusB) {
                        return statusA - statusB;
                    }

                    // 2. ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á (PlacedAt)
                    const timeA = (a.placedAt && typeof a.placedAt.seconds === 'number') ? a.placedAt.seconds : 0;
                    const timeB = (b.placedAt && typeof b.placedAt.seconds === 'number') ? b.placedAt.seconds : 0;
                    
                    return timeA - timeB; // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏Å‡πà‡∏≤‡πÑ‡∏õ‡πÉ‡∏´‡∏°‡πà
                });
                
                renderOrderQueue();
            }, error => {
                // üö® ‡∏´‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏î Error (‡πÄ‡∏ä‡πà‡∏ô Permission Denied) ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏à‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
                console.error("Firebase Order Listener Error:", error);
                orderQueueEl.innerHTML = '<p class="text-red-500 text-center mt-4 font-bold">‚ö†Ô∏è ERROR: ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ (‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Console/Rules)</p>';
            });

            // 2. Listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ (salesLog Collection)
            db.collection("salesLog").onSnapshot(snapshot => {
                menuSalesLog = snapshot.docs.map(doc => doc.data());
                updateSalesDashboard();
            }, error => {
                console.error("Firebase Sales Listener Error:", error);
            });
        }

        // --- Modal Render Functions (‡∏ï‡πâ‡∏≠‡∏á‡∏ô‡∏≥‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤) ---
        // *** ‡πÇ‡∏Ñ‡πâ‡∏î renderMatchaMenu, renderCoffeeMenu, renderFruitSmoothieMenu, ‡πÅ‡∏•‡∏∞ showXxxModal functions ‡∏ï‡πâ‡∏≠‡∏á‡∏ñ‡∏π‡∏Å‡∏ß‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ***
        
        function showMatchaMenuModal() { /* ... */ }
        function renderMatchaMenu() { /* ... */ }
        function showCoffeeMenuModal() { /* ... */ }
        function renderCoffeeMenu() { /* ... */ }
        function showFruitSmoothieModal() { /* ... */ }
        function renderFruitSmoothieMenu() { /* ... */ }
        
        // --- Core Application Logic ---

        function renderMenu() {
             const specialMenuIds = [...matchaMenuData, ...coffeeMenuData, ...fruitSmoothieData, ...smoothieYogurtData].map(item => item.id);
            const otherMenuData = menuData.filter(item => !specialMenuIds.includes(item.id));
            
            const existingSpecialButtons = menuGrid.querySelectorAll('.p-3.bg-amber-700, .p-3.bg-emerald-500, .p-3.bg-sky-500');
            const newGridContent = Array.from(existingSpecialButtons).map(btn => btn.outerHTML).join('');
            menuGrid.innerHTML = newGridContent;

            otherMenuData.forEach(item => {
                const menuItem = document.createElement('div');
                menuItem.className = 'p-3 bg-teal-50 hover:bg-teal-100 rounded-lg text-center cursor-pointer transition duration-300 shadow-sm';
                menuItem.innerHTML = `<span class="font-semibold">${item.name}</span>`;
                menuItem.onclick = () => addToOrder(item.id);
                menuGrid.appendChild(menuItem);
            });
        }

        function addToOrder(itemId) {
            const item = getItemDataById(itemId);
            if (!item) return;

            const defaultSize = Object.keys(item.prices)[0];
            const defaultSweetness = sweetnessOptions[0];

            const orderItem = {
                id: Date.now(),
                itemId: item.id,
                name: item.name,
                size: defaultSize,
                price: item.prices[defaultSize],
                quantity: 1,
                sweetness: defaultSweetness,
            };
            currentOrder.push(orderItem);
            renderCurrentOrder();
            document.getElementById('matcha-modal').classList.add('hidden');
            document.getElementById('coffee-modal').classList.add('hidden');
            document.getElementById('fruit-smoothie-modal').classList.add('hidden');
        }
        
        function renderCurrentOrder() {
            if (currentOrder.length === 0) {
                currentOrderItemsEl.innerHTML = '<p class="text-gray-400 text-center mt-4">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡∏à‡∏≤‡∏Å‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°...</p>';
                submitOrderBtn.disabled = true;
            } else {
                currentOrderItemsEl.innerHTML = '';
                currentOrder.forEach(item => {
                    const menuItem = getItemDataById(item.itemId);
                    const availableSizes = Object.keys(menuItem.prices);

                    const sizeOptions = availableSizes.map(size => `<option value="${size}" ${item.size === size ? 'selected' : ''}>${size}</option>`).join('');
                    const sweetnessDropdown = sweetnessOptions.map(level => `<option value="${level}" ${item.sweetness === level ? 'selected' : ''}>${level}</option>`).join('');

                    const itemEl = document.createElement('div');
                    itemEl.className = 'flex items-center justify-between bg-gray-50 p-2 rounded-lg';
                    itemEl.innerHTML = `
                        <div class="flex-grow grid grid-cols-2 gap-2">
                            <p class="font-semibold col-span-2">${item.name}</p>
                            <div class="flex flex-col">
                                <span class="text-xs font-medium text-gray-500 mb-1">‡∏Ç‡∏ô‡∏≤‡∏î</span>
                                <select class="text-sm p-1 border rounded" onchange="updateOrderItemSize(${item.id}, this.value)">${sizeOptions}</select>
                            </div>
                            <div class="flex flex-col">
                                <span class="text-xs font-medium text-gray-500 mb-1">‡∏´‡∏ß‡∏≤‡∏ô</span>
                                <select class="text-sm p-1 border rounded" onchange="updateOrderItemSweetness(${item.id}, this.value)">${sweetnessDropdown}</select>
                            </div>
                        </div>
                        <div class="flex items-center gap-2 ml-4">
                            <button class="w-6 h-6 bg-gray-200 rounded-full" onclick="updateOrderItemQuantity(${item.id}, -1)">-</button>
                            <span>${item.quantity}</span>
                            <button class="w-6 h-6 bg-gray-200 rounded-full" onclick="updateOrderItemQuantity(${item.id}, 1)">+</button>
                        </div>
                        <span class="w-20 text-right font-semibold">‡∏ø${(item.price * item.quantity).toLocaleString('th-TH')}</span>
                        <button class="ml-2 text-red-500 hover:text-red-700" onclick="removeOrderItem(${item.id})">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                        </button>
                    `;
                    currentOrderItemsEl.appendChild(itemEl);
                });
                submitOrderBtn.disabled = false;
            }
            updateTotalPrice();
        }

        function updateOrderItemSweetness(orderItemId, newSweetness) {
            const orderItem = currentOrder.find(item => item.id === orderItemId);
            orderItem.sweetness = newSweetness;
            renderCurrentOrder();
        }
        
        function updateOrderItemSize(orderItemId, newSize) {
            const orderItem = currentOrder.find(item => item.id === orderItemId);
            const menuItem = getItemDataById(orderItem.itemId);
            if (menuItem.prices[newSize] !== undefined) {
                orderItem.size = newSize;
                orderItem.price = menuItem.prices[newSize];
            }
            renderCurrentOrder();
        }

        function updateOrderItemQuantity(orderItemId, change) {
            const orderItem = currentOrder.find(item => item.id === orderItemId);
            if (orderItem.quantity + change > 0) {
                orderItem.quantity += change;
            }
            renderCurrentOrder();
        }

        function removeOrderItem(orderItemId) {
            currentOrder = currentOrder.filter(item => item.id !== orderItemId);
            renderCurrentOrder();
        }

        function updateTotalPrice() {
            const total = currentOrder.reduce((sum, item) => sum + item.price * item.quantity, 0);
            totalPriceEl.textContent = `‡∏ø${total.toLocaleString('th-TH')}`;
        }
        
        function shareOrderSummary() {
            if (!lastCommittedOrder) {
                alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ä‡∏£‡πå');
                return;
            }

            const itemsText = lastCommittedOrder.items.map(item =>
                `* ${item.name} (${item.size}, ‡∏´‡∏ß‡∏≤‡∏ô ${item.sweetness}) x${item.quantity} = ‡∏ø${(item.price * item.quantity).toLocaleString('th-TH')}`
            ).join('\n');

            const shareText =
                `‚úÖ *‡∏™‡∏£‡∏∏‡∏õ‡∏ö‡∏¥‡∏• #${lastCommittedOrder.id.substring(0, 8)} - ${new Date().toLocaleDateString('th-TH')}*\n` +
                `----------------------------------------\n` +
                `${itemsText}\n` +
                `----------------------------------------\n` +
                `üìç ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: ${lastCommittedOrder.address}\n` +
                `üí∞ *‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô: ‡∏ø${lastCommittedOrder.total.toLocaleString('th-TH')}*\n\n` +
                `üí¨ *[‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô] ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ QR Code ‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏ö‡∏°‡∏≤‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô*\n` +
                `‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ: ‡∏ô.‡∏™.‡∏ô‡∏§‡∏ï‡∏ç‡∏≤ ‡∏ô‡∏≤‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏£‡∏±‡∏Å‡∏©‡πå`;

            if (navigator.share) {
                navigator.share({ title: `‡∏ö‡∏¥‡∏•‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå #${lastCommittedOrder.id.substring(0, 8)}`, text: shareText })
                .catch((error) => {
                    navigator.clipboard.writeText(shareText)
                        .then(() => alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡∏£‡∏∏‡∏õ‡∏ö‡∏¥‡∏• (‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°) ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏Ñ‡∏•‡∏¥‡∏õ‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÅ‡∏•‡πâ‡∏ß!'))
                        .catch(err => console.error('Could not copy text: ', err));
                });
            } else {
                navigator.clipboard.writeText(shareText)
                    .then(() => alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡∏£‡∏∏‡∏õ‡∏ö‡∏¥‡∏• (‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°) ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏Ñ‡∏•‡∏¥‡∏õ‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÅ‡∏•‡πâ‡∏ß!'))
                    .catch(err => console.error('Could not copy text: ', err));
            }
        }


        // üî• UPDATED: Submit Order (‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÉ‡∏ä‡πâ Firestore) üî•
        submitOrderBtn.addEventListener('click', () => {
            const orderTotal = currentOrder.reduce((sum, item) => sum + item.price * item.quantity, 0);

            if (currentOrder.length > 0) {
                const address = deliveryAddressInput.value.trim();
                const isPickup = address === '';
                
                if (isPickup) {
                     if (!confirm("‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà ‡∏à‡∏∞‡∏ñ‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô '‡∏£‡∏±‡∏ö‡πÄ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô' ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) { return; }
                }

                db.collection("orders").add({
                    items: currentOrder,
                    total: orderTotal,
                    address: address || '‡∏£‡∏±‡∏ö‡πÄ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô',
                    status: '‡∏Ñ‡∏¥‡∏ß',
                    placedAt: firebase.firestore.FieldValue.serverTimestamp(), // ‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏≤‡∏Å Server
                })
                .then(docRef => {
                    lastCommittedOrder = {
                         id: docRef.id, 
                         items: [...currentOrder],
                         total: orderTotal,
                         address: address || '‡∏£‡∏±‡∏ö‡πÄ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô',
                    };
                    
                    currentOrder = []; 
                    deliveryAddressInput.value = '';
                    renderCurrentOrder(); 
                    showPaymentQRModal(orderTotal);
                })
                .catch(error => {
                    console.error("Error adding document: ", error);
                    alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà");
                });
            }
        });

        // üî• UPDATED: renderOrderQueue (‡πÉ‡∏ä‡πâ Order ID ‡∏à‡∏≤‡∏Å Firestore ‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≠‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞) üî•
        function renderOrderQueue() {
            const activeQueue = orderQueue.filter(order => order.status !== '‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß' && order.status !== '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å');
            const displayQueue = activeQueue.length > 0 ? activeQueue : orderQueue;


            if (displayQueue.length === 0) {
                orderQueueEl.innerHTML = '<p class="text-gray-400 text-center mt-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏ô‡∏Ñ‡∏¥‡∏ß</p>';
                return;
            }
            
            orderQueueEl.innerHTML = '';
            displayQueue.forEach(order => {
                const itemsSummary = order.items.map(item => `${item.name} (${item.size}, ‡∏´‡∏ß‡∏≤‡∏ô ${item.sweetness}) x${item.quantity}`).join(', ');
                const statusColor = {
                    '‡∏Ñ‡∏¥‡∏ß': 'bg-blue-100 text-blue-800',
                    '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥': 'bg-yellow-100 text-yellow-800',
                    '‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß': 'bg-green-100 text-green-800',
                    '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å': 'bg-red-100 text-red-800'
                }[order.status];
                
                const isCompleted = order.status === '‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß' || order.status === '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å';

                const orderCard = document.createElement('div');
                orderCard.className = `p-4 rounded-lg shadow-sm ${isCompleted ? 'bg-gray-200 opacity-75' : 'bg-gray-50 hover:bg-white'}`;
                
                // ‡πÉ‡∏ä‡πâ order.id ‡∏à‡∏≤‡∏Å Firebase (‡πÄ‡∏õ‡πá‡∏ô string)
                orderCard.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <h4 class="font-bold text-lg">‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå #${order.id.substring(0, 8)}...</h4> 
                            <p class="text-sm text-gray-600">${itemsSummary}</p>
                            <p class="text-xs text-gray-500 mt-1">
                                <span class="font-semibold">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</span> ${order.address}
                            </p>
                        </div>
                        <span class="text-lg font-bold text-teal-600">‡∏ø${order.total.toLocaleString('th-TH')}</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-sm font-semibold px-2.5 py-0.5 rounded-full ${statusColor}">${order.status}</span>
                        <div class="flex gap-2">
                            ${order.status === '‡∏Ñ‡∏¥‡∏ß' ? `<button class="text-xs bg-yellow-400 hover:bg-yellow-500 text-white font-bold py-1 px-3 rounded-lg" onclick="updateOrderStatus('${order.id}', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥')">‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</button>` : ''}
                            ${order.status === '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥' ? `<button class="text-xs bg-green-500 hover:bg-green-600 text-white font-bold py-1 px-3 rounded-lg" onclick="updateOrderStatus('${order.id}', '‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß')">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</button>` : ''}
                            ${!isCompleted ? `<button class="text-xs bg-red-500 hover:bg-red-600 text-white font-bold py-1 px-3 rounded-lg" onclick="updateOrderStatus('${order.id}', '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å')">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>` : ''}
                        </div>
                    </div>
                `;
                orderQueueEl.appendChild(orderCard);
            });
        }

        // üî• UPDATED: updateOrderStatus (‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏°‡∏≤‡πÉ‡∏ä‡πâ Firebase ID/Doc Ref) üî•
        function updateOrderStatus(orderId, newStatus) {
            const order = orderQueue.find(o => o.id === orderId);
            if (!order) return;

            const updateData = { status: newStatus };
            if (newStatus === '‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß') {
                updateData.completedAt = firebase.firestore.FieldValue.serverTimestamp();
                
                const batch = db.batch(); 
                order.items.forEach(item => {
                    const newLogRef = db.collection("salesLog").doc();
                    batch.set(newLogRef, {
                        name: item.name,
                        size: item.size,
                        sweetness: item.sweetness,
                        quantity: item.quantity,
                        price: item.price,
                        soldAt: updateData.completedAt,
                        orderId: orderId
                    });
                });
                batch.commit().then(() => {
                    console.log("Sales Log batch successfully written!");
                }).catch((error) => {
                    console.error("Error writing sales log batch: ", error);
                });
            }
            
            db.collection("orders").doc(orderId).update(updateData)
                .then(() => console.log("Order status updated!"))
                .catch(error => console.error("Error updating order: ", error));
        }

        function updateSalesDashboard() {
            let salesToday = 0;
            let salesWeek = 0;
            let salesMonth = 0;
            
            menuSalesLog.forEach(log => {
                const saleDate = log.soldAt ? new Date(log.soldAt.seconds * 1000) : new Date();
                
                const totalRevenue = log.price * log.quantity;

                if (isToday(saleDate)) { salesToday += totalRevenue; }
                if (isThisWeek(saleDate)) { salesWeek += totalRevenue; }
                if (isThisMonth(saleDate)) { salesMonth += totalRevenue; }
            });
            
            salesTodayEl.textContent = `‡∏ø${salesToday.toLocaleString('th-TH')}`;
            salesWeekEl.textContent = `‡∏ø${salesWeek.toLocaleString('th-TH')}`;
            salesMonthEl.textContent = `‡∏ø${salesMonth.toLocaleString('th-TH')}`;
        }

        function showMenuReport() {
            const menuSales = {};
            
            menuSalesLog.forEach(log => {
                const key = `${log.name} (${log.size}, ‡∏´‡∏ß‡∏≤‡∏ô ${log.sweetness})`;
                if (!menuSales[key]) {
                    menuSales[key] = { name: log.name, size: log.size, sweetness: log.sweetness, totalQuantity: 0, totalRevenue: 0, };
                }
                menuSales[key].totalQuantity += log.quantity;
                menuSales[key].totalRevenue += log.price * log.quantity;
            });
            
            const sortedMenuReport = Object.values(menuSales).sort((a, b) => b.totalQuantity - a.totalQuantity);
            let tableHTML = '<p class="text-gray-500 mb-4">‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏Å‡πâ‡∏ß‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</p>';
            if (sortedMenuReport.length === 0) {
                tableHTML += '<p class="text-center text-gray-400 mt-10">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå</p>';
            } else {
                tableHTML += `<table class="min-w-full divide-y divide-gray-200"><thead class="bg-teal-50"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡πÄ‡∏°‡∏ô‡∏π / ‡∏Ç‡∏ô‡∏≤‡∏î / ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ß‡∏≤‡∏ô</th><th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (‡πÅ‡∏Å‡πâ‡∏ß)</th><th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏° (‡∏ø)</th></tr></thead><tbody class="bg-white divide-y divide-gray-200">`;
                sortedMenuReport.forEach( (report, index) => {
                    tableHTML += `<tr class="${index < 3 ? 'bg-yellow-50 font-semibold' : ''}"><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${report.name} (${report.size}, ‡∏´‡∏ß‡∏≤‡∏ô ${report.sweetness})</td><td class="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900">${report.totalQuantity.toLocaleString('th-TH')}</td><td class="px-6 py-4 whitespace-nowrap text-sm text-right text-teal-600">${report.totalRevenue.toLocaleString('th-TH')}</td></tr>`;
                });
                tableHTML += '</tbody></table>';
            }
            menuReportContent.innerHTML = tableHTML;
            menuReportModal.classList.remove('hidden');
        }
        
        // Initial setup
        renderMenu();
        renderCurrentOrder();
        initFirebaseListeners(); // ** ‡πÄ‡∏£‡∏¥‡πà‡∏° Listener ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà **
    </script>
    
    <script>
        // ‡πÇ‡∏Ñ‡πâ‡∏î Modal Functions ‡∏ó‡∏µ‡πà‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡∏ï‡πâ‡∏≠‡∏á‡∏ô‡∏≥‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
        
        // (*** ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô renderMatchaMenu, renderCoffeeMenu, renderFruitSmoothieMenu, ‡πÅ‡∏•‡∏∞ showXxxModal functions ‡∏ï‡πâ‡∏≠‡∏á‡∏ñ‡∏π‡∏Å‡∏ß‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ***)
        
        // ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î Modal ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ
        // ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ô‡∏≥‡∏™‡πà‡∏ß‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡∏°‡∏≤‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏ï‡πá‡∏°‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏£‡∏±‡∏ö
        
        // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î‡∏´‡∏≤‡∏¢‡πÑ‡∏õ:
        
        function renderMatchaMenu() {
            const matchaMenuListEl = document.getElementById('matcha-menu-list');
            matchaMenuListEl.innerHTML = '';
            matchaMenuData.forEach(item => {
                const p16 = item.prices['16 Oz. ‡πÄ‡∏¢‡πá‡∏ô'] ? `‡∏ø${item.prices['16 Oz. ‡πÄ‡∏¢‡πá‡∏ô']}` : 'X';
                const p22 = item.prices['22 Oz. ‡πÄ‡∏¢‡πá‡∏ô'] || item.prices['22 Oz. ‡∏õ‡∏±‡πà‡∏ô'];
                const p22Display = p22 ? `‡∏ø${p22}` : 'X';

                const menuCard = document.createElement('div');
                menuCard.className = 'matcha-menu-card';
                menuCard.setAttribute('onclick', `addToOrder(${item.id})`);
                menuCard.innerHTML = `
                    <span class="w-1/2 text-sm font-medium text-gray-800">${item.name}</span>
                    <span class="w-1/4 text-center text-sm ${p16 === 'X' ? 'text-red-500' : 'price-small'}">${p16}</span>
                    <span class="w-1/4 text-center text-sm ${p22Display === 'X' ? 'text-red-500' : 'price-large'}">${p22Display}</span>
                `;
                matchaMenuListEl.appendChild(menuCard);
            });
        }
        
        function showMatchaMenuModal() {
            renderMatchaMenu();
            document.getElementById('matcha-modal').classList.remove('hidden');
        }
        
        // (‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö Modal ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏°‡∏≤‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ)

    </script>

</body>
</html>
